
@model PagedList.IPagedList<Core.Domain.Models.ViewModels.MailInboxViewModel>
@using Kendo.Mvc.UI



<head>
    <link href="~/Content/DashBoard/MailInbox.css" rel="stylesheet" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <link href="https://netdna.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <script src="~/Content/signal/jquery.signalR-2.1.1.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
</head>

<div class="table-responsive" style="overflow: scroll; width: 900px; height: 500px;">
    <table class="table">
        <tbody class="table table-condensed table-hover table-striped" id="underConstructionRequests" style="overflow:auto;">
            @foreach (var item in Model)
            {
                <tr>
                    @if (!string.IsNullOrEmpty(item.FromUserName))
                    {
                        <td>
                            @Html.DisplayFor(modelItem => item.FromUserName)
                        </td>
                    }

                    @if (!string.IsNullOrEmpty(item.ToUserName))
                    {
                        <td>
                            @Html.DisplayFor(modelItem => item.ToUserName)
                        </td>
                    }

                </tr>
                <tr class="@(item.IsRead.Value ? "read" :"alert-custom")">
                    <td>
                    <td onclick="DivInboxCard('@Infrastructure.Helpers.Security.WebUiUtility.Encrypt(@item.Id.ToString())')">
                        @Html.DisplayFor(modelItem => item.Subject)
                    </td>
                    <td>
                        @item.Date.Value.ToString()
                    </td>
                    @if (item.Type != null && item.Type == ((int)Infrastructure.Helpers.Enums.MailTypes.New).ToString())
                    {
                        <td class="action" id="@item.InboxGuid.ToString()tds" data-IsStarred="@(item.IsStarred == false ? "false" : "true")"
                            onclick="SaveSatrInbox('@Infrastructure.Helpers.Security.WebUiUtility.Encrypt(@item.Id.ToString())',
                            '@item.InboxGuid.ToString()', this)">
                            <i id="@item.InboxGuid.ToString()star" class="@(item.IsStarred ==false ? "fa fa-star-o" : "fa fa-star")"></i>
                        </td>

                    }

                    @if (item.IsAttached != null && item.IsAttached == true)
                    {
                        <td class="view-message  inbox-small-cells"><i class="fa fa-paperclip"></i></td>
                    }

                </tr>
            }

        </tbody>
    </table>
</div>


<script>
    function DivInboxCard(id) {
        window.location.href = "/Managment/DashBoardManagement/InboxCard?InboxId=" + id;
    }
    function SaveSatrInbox(id, from, IsStarted) {
        var dataIsStarred = $("#" + from + "tds").attr('data-IsStarred')
        $.ajax({
            type: "Post",
            url: '/DashBoardManagement/SaveInboxAsStarred/',
            dataType: "Json",
            data: { InboxId: id, IsStarted: dataIsStarred },
            success: function (data) {
                ;
                if (data.Success == true) {
                    if (data.Data == '@Infrastructure.Resources.Validations.English.ValidationResponses.SatredInbox') {
                    $("#" + from + "star").removeClass("fa fa-star-o");
                        $("#" + from + "star").addClass("fa fa-star");
                        $("#" + from + "tds").attr("data-IsStarred", true);
                    }
                    if (data.Data == '@Infrastructure.Resources.Validations.English.ValidationResponses.NotStaredInbox') {

                        $("#" + from + "star").removeClass("fa fa-star");
                        $("#" + from + "star").addClass("fa fa-star-o");
                        $("#" + from + "tds").attr("data-IsStarred", false);
                    }

                    $('#StarredId span').text(data.ModelCount);
                }

            },
            error: function (data) {
                if (data.Success === false) {
                    toastr["error"]("error happen try again", "");
                }
            }
        });

    }
</script>

